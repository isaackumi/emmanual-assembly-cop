(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[741],{3008:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6369:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},5817:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},9670:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},1295:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},6142:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},7472:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},2741:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},9883:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},1827:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(2898).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},4774:function(e,s,t){Promise.resolve().then(t.bind(t,7643))},7643:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return z}});var r=t(7437),l=t(2265),a=t(4033),i=t(9477),n=t(7815),c=t(5754),d=t(5179),o=t(1478),x=t(4599),m=t(1657),h=t(3067),u=t(5817),f=t(9883),g=t(5750),j=t(8203),v=t(3008),y=t(6369),b=t(1827),p=t(7972),N=t(2741),w=t(1295),Z=t(6142),k=t(9670),_=t(9617),C=t(7472);function z(){let{user:e,loading:s}=(0,i.useAuth)(),t=(0,a.useRouter)(),z=(0,x.e)(),[D,M]=(0,l.useState)([]),[S,F]=(0,l.useState)(!0),[E,V]=(0,l.useState)(""),[L,q]=(0,l.useState)("all");(0,l.useEffect)(()=>{s||e||t.push("/auth")},[e,s,t]),(0,l.useEffect)(()=>{e&&A()},[e]);let A=async()=>{try{F(!0),console.log("Fetching visitors...");let{data:e,error:s}=await z.from("visitors").select("\n          *,\n          invited_by:members(user:app_users(full_name))\n        ").eq("is_active",!0).order("visit_date",{ascending:!1});if(s)throw console.error("Error fetching visitors:",s),s;console.log("Visitors fetched:",e),M(e||[])}catch(e){console.error("Error fetching visitors:",e)}finally{F(!1)}},G=D.filter(e=>{var s,t,r;let l=""===E||(null===(s=e.first_name)||void 0===s?void 0:s.toLowerCase().includes(E.toLowerCase()))||(null===(t=e.last_name)||void 0===t?void 0:t.toLowerCase().includes(E.toLowerCase()))||(null===(r=e.phone)||void 0===r?void 0:r.includes(E)),a="all"===L||"converted"===L&&e.converted_to_member||"followup"===L&&!e.follow_up_completed||"recent"===L&&new Date(e.visit_date)>new Date(Date.now()-2592e6);return l&&a}),Y=e=>e.converted_to_member?"bg-green-100 text-green-800":e.follow_up_completed?new Date(e.visit_date)>new Date(Date.now()-2592e6)?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800",P=e=>e.converted_to_member?"Converted":e.follow_up_completed?new Date(e.visit_date)>new Date(Date.now()-2592e6)?"Recent":"Active":"Needs Follow-up";return s||S?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),(0,r.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,r.jsx)("div",{className:"h-32 bg-gray-200 rounded"},s))})]})})}):e?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center mb-2",children:(0,r.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>t.push("/dashboard"),className:"mr-3 text-gray-600 hover:text-gray-900",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 mr-1"}),"Back to Dashboard"]})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",style:{fontFamily:'"Space Grotesk", sans-serif'},children:"Visitor Management"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Track and manage church visitors"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(c.z,{variant:"outline",className:"flex items-center",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,r.jsxs)(c.z,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>t.push("/visitors/add"),children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Add Visitor"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,r.jsx)(n.Zb,{className:"bg-white shadow-sm border border-gray-100",children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Total Visitors"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",style:{fontFamily:'"Space Grotesk", sans-serif'},children:D.length})]}),(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(g.Z,{className:"h-5 w-5 text-blue-600"})})]})})}),(0,r.jsx)(n.Zb,{className:"bg-white shadow-sm border border-gray-100",children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Recent Visitors"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",style:{fontFamily:'"Space Grotesk", sans-serif'},children:D.filter(e=>new Date(e.visit_date)>new Date(Date.now()-2592e6)).length}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Last 30 days"})]}),(0,r.jsx)("div",{className:"w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(j.Z,{className:"h-5 w-5 text-green-600"})})]})})}),(0,r.jsx)(n.Zb,{className:"bg-white shadow-sm border border-gray-100",children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Converted"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",style:{fontFamily:'"Space Grotesk", sans-serif'},children:D.filter(e=>e.converted_to_member).length}),(0,r.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"To members"})]}),(0,r.jsx)("div",{className:"w-10 h-10 bg-yellow-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(v.Z,{className:"h-5 w-5 text-yellow-600"})})]})})}),(0,r.jsx)(n.Zb,{className:"bg-white shadow-sm border border-gray-100",children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Need Follow-up"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",style:{fontFamily:'"Space Grotesk", sans-serif'},children:D.filter(e=>!e.follow_up_completed).length}),(0,r.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Pending"})]}),(0,r.jsx)("div",{className:"w-10 h-10 bg-red-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(y.Z,{className:"h-5 w-5 text-red-600"})})]})})})]}),(0,r.jsx)(n.Zb,{className:"mb-6",children:(0,r.jsx)(n.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(b.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)(d.I,{placeholder:"Search visitors by name or phone...",value:E,onChange:e=>V(e.target.value),className:"pl-10"})]})}),(0,r.jsx)("div",{className:"flex items-center space-x-3",children:(0,r.jsxs)("select",{value:L,onChange:e=>q(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"all",children:"All Visitors"}),(0,r.jsx)("option",{value:"recent",children:"Recent (30 days)"}),(0,r.jsx)("option",{value:"followup",children:"Needs Follow-up"}),(0,r.jsx)("option",{value:"converted",children:"Converted to Members"})]})})]})})}),(0,r.jsxs)(n.Zb,{children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{style:{fontFamily:'"Space Grotesk", sans-serif'},children:["Visitors (",G.length,")"]}),(0,r.jsxs)(o.C,{variant:"outline",className:"text-sm",children:[D.length," total"]})]})}),(0,r.jsx)(n.aY,{children:G.length>0?(0,r.jsx)("div",{className:"space-y-4",children:G.map(e=>{var s;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center",children:(0,r.jsx)(p.Z,{className:"h-6 w-6 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold text-gray-900",children:[e.first_name," ",e.last_name]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[e.phone&&(0,r.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,r.jsx)(N.Z,{className:"h-3 w-3 mr-1"}),e.phone]}),e.email&&(0,r.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,r.jsx)(w.Z,{className:"h-3 w-3 mr-1"}),e.email]}),(0,r.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,r.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),(0,m.p6)(e.visit_date)]}),e.address&&(0,r.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,r.jsx)(Z.Z,{className:"h-3 w-3 mr-1"}),e.address.split(",")[0]]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[e.service_attended&&(0,r.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:e.service_attended}),e.invited_by&&(0,r.jsxs)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:["Invited by ",null===(s=e.invited_by.user)||void 0===s?void 0:s.full_name]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(o.C,{className:Y(e),children:P(e)}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(c.z,{variant:"ghost",size:"sm",onClick:()=>t.push("/visitors/".concat(e.id)),children:(0,r.jsx)(k.Z,{className:"h-4 w-4"})}),(0,r.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,r.jsx)(_.Z,{className:"h-4 w-4"})}),(0,r.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,r.jsx)(C.Z,{className:"h-4 w-4"})})]})]})]},e.id)})}):(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(g.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No visitors found"}),(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:E||"all"!==L?"Try adjusting your search or filter criteria.":"Get started by adding your first visitor."}),(0,r.jsxs)(c.z,{className:"bg-blue-600 hover:bg-blue-700",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Add Visitor"]})]})})]})]})}):null}},5179:function(e,s,t){"use strict";t.d(s,{I:function(){return i}});var r=t(7437),l=t(2265),a=t(1657);let i=l.forwardRef((e,s)=>{let{className:t,type:l,...i}=e;return(0,r.jsx)("input",{type:l,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...i})});i.displayName="Input"}},function(e){e.O(0,[895,833,372,971,938,744],function(){return e(e.s=4774)}),_N_E=e.O()}]);