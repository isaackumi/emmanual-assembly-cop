"use strict";(()=>{var e={};e.id=910,e.ids=[910],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},1414:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>m});var s={};t.r(s),t.d(s,{POST:()=>p});var o=t(5419),n=t(9108),i=t(9678),a=t(8070),u=t(134);async function p(e){try{let{phoneOrId:t,action:s}=await e.json();if(!t||!s)return a.Z.json({error:"Phone number or membership ID and action are required"},{status:400});let o=(0,u.i)(),n=t.trim();if(t.toUpperCase().includes("EA")){let e=function(e){if(!e)return"";let r=e.replace(/[^A-Za-z0-9-]/g,"").toUpperCase();if(/^EA-\d{4}-\d{4}$/.test(r))return r;if(/^\d{8}$/.test(r))return`EA-${r.slice(0,4)}-${r.slice(4)}`;if(r.startsWith("EA")){let e=r.replace(/[^0-9]/g,"");if(8===e.length)return`EA-${e.slice(0,4)}-${e.slice(4)}`}return r}(t),{data:r,error:s}=await o.from("app_users").select("id, phone").eq("membership_id",e).single();if(s||!r)return a.Z.json({error:"Membership ID not found"},{status:404});if(!r.phone)return a.Z.json({error:"No phone number associated with this membership ID"},{status:400});n=r.phone,r.id}else{var r;if(r=n,!/^(\+233|0)?[0-9]{9}$/.test(r.replace(/\s/g,"")))return a.Z.json({error:"Invalid phone number format"},{status:400});n.startsWith("0")?n="+233"+n.slice(1):n.startsWith("+")||(n="+233"+n);let{data:e,error:t}=await o.from("app_users").select("id, phone").eq("phone",n).single();if(t||!e)return a.Z.json({error:"Phone number not found in system"},{status:404});e.id}if("send"===s){let{error:e}=await o.auth.signInWithOtp({phone:n,options:{channel:"sms"}});if(e)return console.error("OTP Error:",e),a.Z.json({error:"Failed to send OTP"},{status:500});return a.Z.json({success:!0,message:"OTP sent successfully",phone:n})}return a.Z.json({error:"Invalid action"},{status:400})}catch(e){return console.error("OTP API Error:",e),a.Z.json({error:"Internal server error"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/otp/route",pathname:"/api/otp",filename:"route",bundlePath:"app/api/otp/route"},resolvedPagePath:"/Users/isaackumi/devel/gigs/cop-chMS/app/api/otp/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:h,headerHooks:f,staticGenerationBailout:m}=l,g="/api/otp/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}},134:(e,r,t)=>{t.d(r,{i:()=>o});var s=t(2964);function o(){return(0,s.eI)("https://dsgewsnslfdylvieulsc.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,964,206],()=>t(1414));module.exports=s})();