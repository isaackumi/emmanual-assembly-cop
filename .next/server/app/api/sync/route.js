"use strict";(()=>{var e={};e.id=475,e.ids=[475],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},5996:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>y,originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>c});var a=t(5419),n=t(9108),i=t(9678),o=t(8070),u=t(134);async function c(e){try{let r,t;let{table_name:s,operation:a,data:n,client_uuid:i}=await e.json();if(!s||!a||!n||!i)return o.Z.json({error:"Missing required fields"},{status:400});let c=(0,u.i)();if("attendance"===s&&"INSERT"===a){let{data:e}=await c.from("attendance").select("id").eq("client_uuid",i).single();if(e)return o.Z.json({success:!0,message:"Record already exists",id:e.id})}if("attendance"!==s)return o.Z.json({error:"Unsupported table"},{status:400});if("INSERT"!==a)return o.Z.json({error:"Unsupported operation for attendance table"},{status:400});{let e={member_id:n.member_id,dependant_id:n.dependant_id,service_date:n.service_date,service_type:n.service_type,check_in_time:n.check_in_time||new Date().toISOString(),method:n.method||"mobile",metadata:n.metadata||{},client_uuid:i,created_by:n.created_by},{data:s,error:a}=await c.from("attendance").insert(e).select().single();r=s,t=a}if(t)return console.error("Sync error:",t),o.Z.json({error:"Failed to sync data",details:t.message},{status:500});return o.Z.json({success:!0,data:r,message:"Data synced successfully"})}catch(e){return console.error("Sync API error:",e),o.Z.json({error:"Internal server error"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("client_uuid");if(!t)return o.Z.json({error:"client_uuid is required"},{status:400});let s=(0,u.i)(),{data:a,error:n}=await s.from("attendance").select("id, client_uuid, created_at").eq("client_uuid",t).single();if(n&&"PGRST116"!==n.code)return console.error("Status check error:",n),o.Z.json({error:"Failed to check sync status"},{status:500});return o.Z.json({exists:!!a,synced:!!a,synced_at:a?.created_at||null})}catch(e){return console.error("Status check API error:",e),o.Z.json({error:"Internal server error"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/sync/route",pathname:"/api/sync",filename:"route",bundlePath:"app/api/sync/route"},resolvedPagePath:"/Users/isaackumi/devel/gigs/cop-chMS/app/api/sync/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:_,headerHooks:y,staticGenerationBailout:h}=l,f="/api/sync/route";function g(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},134:(e,r,t)=>{t.d(r,{i:()=>a});var s=t(2964);function a(){return(0,s.eI)("https://dsgewsnslfdylvieulsc.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,964,206],()=>t(5996));module.exports=s})();